# 重绘与重排

标签（空格分隔）： 高性能JavaScript

---

 浏览器下载完页面中的所有组件--`HTML 标记`, `JavaScript`, `css`, 图片--之后会解析并生成两个内部数据结构
 1. `DOM` 树： 表示页面的结构
 2. 渲染树： 表示 `DOM` 节点如何显示

`DOM` 树中的每一个需要显示的节点在渲染树中至少有一个对应的节点（隐藏的 `DOM` 元素在渲染树中没有对应的节点）。渲染树中的节点被称为 “帧” 或 “盒”，符合`CSS`模型的定义。一旦 `DOM` 和渲染树构建完成，浏览器就开始显示（绘制 “paint”）页面元素

___
#### 什么是重排和重绘 ?

当 `DOM` 的变化影响了元素的几何属性（宽和高）---比如改变边框宽度或给段落增加文字，导致行数增加--浏览器需要重新计算元素的几何属性，同样其他元素的几何属性和位置也会因此受到影响。浏览器会使渲染树中受到影响的部分失效，并重新构造渲染树。这个过程称为 “重排（`reflow`）”。完成重排后，浏览器会重新绘制受影响的部分到屏幕中，该过程称为 “重绘（`repaint`）”

___
#### 重排何时发生？
* 添加或删除可见的`DOM` 元素
* 元素位置改变
* 元素尺寸改变（包括： 外边距，内边距，边框厚度，宽度，高度等属性改变）
* 内容改变，例如： 文本改变或图片被另一个不同尺寸的图片代替
* 页面渲染器初始化
* 流浪器窗口尺寸改变

#### 渲染树变化的排队与刷新
由于每次重排都会产生计算消耗，大多数浏览器通过队列化修改并批量执行来优化重排过程。但某些操作会不经意间强制刷新队列并要求计划任务立刻执行。如获取布局信息的操作会导致队列刷新：

* offsetTop, offsetLeft, offsetWidth, offsetHeight
* scrollTop, scrollLeft, scrollWidth, scrollHeight
* clientTop, clientleft, clientWidth, sclientHeight
* getComput6edStyle(), (currentStyle in IE)
____

#### 最小化重排和重绘
重排和重绘代价非常昂贵。应该减少

##### **批量修改DOM**
当你要对 `DOM` 元素进行一系列操作时，可以通过一下步骤来减少重绘和重排的次数
1. 使元素脱离文档流
2. 对其应用多重改变
3. 把元素带回文档中

有三种方法可以使 `DOM` 脱离文档:
* 隐藏元素，应用修改，重新显示
* 使用文档断片（`document fragment`）在当前 `DOM` 之外构建一个子树，再把它拷贝回去文档
* 将原始元素拷贝到一个脱离文档的节点中，修改副本，完成后再替换为原始元素